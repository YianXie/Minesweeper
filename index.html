<!DOCTYPE html>
<html>
    <head>
        <title>扫雷</title>
        <style>
            /* Css Style */
            body {
                position: fixed;
                left: 26.5%;
                top: 10%;
            }

            #bigtitle {
                position: fixed;
                left: 48.5%;
                top: 0%;
            }

            table td {
                width: 70px;
                height: 70px;
                /* border: 1px none black; */
                text-align: center;
            }

            button {
                width: 70px;
                height: 70px;
                background-color: transparent;
                border: none;
            }

            td {
                background-color: rgb(189, 189, 189);
                box-shadow: 0 0 10px rgba(222, 222, 222, 0.8);
            }

            .minesweeper {
                margin: 0 auto;
            }

            #left_flag_number {
                position: fixed;
                left: 27%;
                top: 2%;
            }

            #total_used_time {
                position: fixed;
                left: 71.5%;
                top: 2%;
            }
        </style>
    </head>
    <body>
        <h1 id="bigtitle">扫雷</h1>
        <h3 id="left_flag_number">10 more flag(s)</h3>
        <h3 id="total_used_time">0</h3>
        <table class="minesweeper" id="minesweeper_table">
            <!-- Main Game -->
            <tr onclick="click_row(this)">
                <td onclick="click_column(this)" contextmenu=""><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
            </tr>
            <tr onclick="click_row(this)">
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
            </tr>
            <tr onclick="click_row(this)">
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
            </tr>
            <tr onclick="click_row(this)">
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
            </tr>
            <tr onclick="click_row(this)">
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
            </tr>
            <tr onclick="click_row(this)">
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
            </tr>
            <tr onclick="click_row(this)">
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
            </tr>
            <tr onclick="click_row(this)">
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
            </tr>
            <tr onclick="click_row(this)">
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
                <td onclick="click_column(this)"><button></button></td>
            </tr>
        </table>
        <script>
            // Variables
            var landmine_coor = [];
            var click_row_number = 0;
            var click_column_number = 0;
            var minesweeper_table = document.getElementById("minesweeper_table");
            var changed_value;
            var left_flag = 10;
            var td_cells = document.querySelectorAll("td");
            var tr_cells = document.querySelectorAll("tr");
            var total_time = 0;
            var win_or_not = false;
            var win_percentage = 1;
            var tr_cell;

            setInterval(update_time,1000);

            function update_time() {
                total_time += 1;
                document.getElementById("total_used_time").innerHTML = total_time;
            }

            for (let i=0;i<10;i++) {
                // Get the landmine coords
                let random_row = Math.floor(Math.random() * 8); // Random numbers
                let random_column = Math.floor(Math.random() * 8); // Random numbers
                random_row = random_row.toString();
                random_column = random_column.toString();
                let added_value = random_row + "" + random_column;
                // Prevent same number from appearing
                if (landmine_coor.includes(added_value)) {
                    i -= 1
                    continue;
                } else {
                    landmine_coor.push(added_value);
                };
            };

            function click_row(row) {
                // Get the row number
                click_row_number = row.rowIndex;
                check_landmine();
            };

            function click_column(cell) {
                // Get the cell number
                click_column_number = cell.cellIndex;
            };

            function check_landmine() {
                // Main Function
                var landmine_number = 0;
                changed_value = minesweeper_table.rows[click_row_number].cells[click_column_number];
                if (landmine_coor.includes(click_row_number.toString() + "" + click_column_number.toString())) {
                    // If the player click on the landmine...
                    changed_value.style.backgroundColor = "red";
                    alert("You failed!");
                } else {
                    // Check if the cell user clicked is landmine
                    if (landmine_coor.includes((parseInt(click_row_number) - 1).toString() + click_column_number)) {

                        landmine_number += 1;
                        changed_value.style.fontSize = "50px";
                        minesweeper_table.rows[click_row_number].cells[click_column_number].innerHTML = landmine_number;
                        changed_value.style.backgroundColor = "white";

                    } if (landmine_coor.includes((parseInt(click_row_number) - 1).toString() + parseInt(click_column_number -1).toString())) {

                        landmine_number += 1;
                        changed_value.style.fontSize = "50px";
                        minesweeper_table.rows[click_row_number].cells[click_column_number].innerHTML = landmine_number;
                        changed_value.style.backgroundColor = "white";

                    } if (landmine_coor.includes((parseInt(click_row_number) - 1).toString() + parseInt(click_column_number +1).toString())) {

                        landmine_number += 1;
                        changed_value.style.fontSize = "50px";
                        minesweeper_table.rows[click_row_number].cells[click_column_number].innerHTML = landmine_number;
                        changed_value.style.backgroundColor = "white";

                    } if (landmine_coor.includes((parseInt(click_row_number) + 1).toString() + parseInt(click_column_number -1).toString())) {

                        landmine_number += 1;
                        changed_value.style.fontSize = "50px";
                        minesweeper_table.rows[click_row_number].cells[click_column_number].innerHTML = landmine_number;
                        changed_value.style.backgroundColor = "white";

                    } if (landmine_coor.includes((parseInt(click_row_number) + 1).toString() + parseInt(click_column_number +1).toString())) {

                        landmine_number += 1;
                        changed_value.style.fontSize = "50px";
                        minesweeper_table.rows[click_row_number].cells[click_column_number].innerHTML = landmine_number;
                        changed_value.style.backgroundColor = "white";

                    } if (landmine_coor.includes((parseInt(click_row_number) + 1).toString() + parseInt(click_column_number).toString())) {

                        landmine_number += 1;
                        changed_value.style.fontSize = "50px";
                        minesweeper_table.rows[click_row_number].cells[click_column_number].innerHTML = landmine_number;
                        changed_value.style.backgroundColor = "white";

                    } if (landmine_coor.includes((parseInt(click_row_number)).toString() + parseInt(click_column_number -1).toString())) {

                        landmine_number += 1;
                        changed_value.style.fontSize = "50px";
                        minesweeper_table.rows[click_row_number].cells[click_column_number].innerHTML = landmine_number;
                        changed_value.style.backgroundColor = "white";

                    } if (landmine_coor.includes((parseInt(click_row_number)).toString() + parseInt(click_column_number +1).toString())) {

                        landmine_number += 1;
                        changed_value.style.fontSize = "50px";
                        minesweeper_table.rows[click_row_number].cells[click_column_number].innerHTML = landmine_number;
                        changed_value.style.backgroundColor = "white";
                        
                    } else {
                        // If there is no landmine beside the cell, only change the color into white
                        changed_value.style.backgroundColor = "white";
                    };
                    // Change the color of the number depend on the value
                    var number_on_the_cell = minesweeper_table.rows[click_row_number].cells[click_column_number].innerHTML;
                    if (number_on_the_cell == 1) {
                        minesweeper_table.rows[click_row_number].cells[click_column_number].style.color = "blue";
                    } else if (number_on_the_cell == 2) {
                        minesweeper_table.rows[click_row_number].cells[click_column_number].style.color = "green";
                    } else if (number_on_the_cell == 3) {
                        minesweeper_table.rows[click_row_number].cells[click_column_number].style.color = "red";
                    } else if (number_on_the_cell >= 4) {
                        minesweeper_table.rows[click_row_number].cells[click_column_number].style.color = "purple";
                    }
                };
            };

            td_cells.forEach(cell => {
                cell.addEventListener("contextmenu", function(event) {
                    event.preventDefault(); // Prevent user from getting right-click information
                    var landmine_coor_copy = [...landmine_coor]; // Copy the array to avoid modifying it during iteration
                    var allLandminesFlagged = true;

                    for (let x = 0; x < landmine_coor_copy.length; x++) {
                        const split_value = landmine_coor_copy[x].split("");
                        const landmineCell = minesweeper_table.rows[split_value[0]].cells[split_value[1]];
                        
                        if (landmineCell.style.backgroundColor === "yellow") {
                            landmine_coor_copy.splice(x, 1);
                            x--; // Adjust the index to account for the removed element
                        } else {
                            allLandminesFlagged = false;
                        }
                    }

                    if (!allLandminesFlagged || landmine_coor_copy.length !== 0) {
                        if (left_flag > 0 && cell.style.backgroundColor !== "yellow") {
                        left_flag -= 1;
                        cell.style.backgroundColor = "yellow"; // Yellow represents flag in Minesweeper
                        document.getElementById("left_flag_number").innerHTML = left_flag + " more flags";
                        } else if (left_flag <= 0) {
                            alert("No more flags!");
                        };
                    } else {
                        alert("You Won!");
                    };
                });
            });
        </script>
    </body>
</html>
